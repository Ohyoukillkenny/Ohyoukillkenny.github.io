<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Lingkun&#39;s Small House</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Lingkun&#39;s Small House">
<meta property="og:url" content="https://ohyoukillkenny.github.io/blog/page/3/index.html">
<meta property="og:site_name" content="Lingkun&#39;s Small House">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lingkun&#39;s Small House">
  
    <link rel="alternate" href="/blog/atom.xml" title="Lingkun&#39;s Small House" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/blog/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">Lingkun&#39;s Small House</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/blog/" id="subtitle">In me the tiger sniffs the rose.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://ohyoukillkenny.github.io/blog"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-null-in-solidity" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/01/07/null-in-solidity/" class="article-date">
  <time datetime="2018-01-07T07:47:08.000Z" itemprop="datePublished">2018-01-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/Learn-Solidity/">Learn Solidity</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/01/07/null-in-solidity/">NULL in Solidity</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Inexistent-NULL-in-Solidity"><a href="#Inexistent-NULL-in-Solidity" class="headerlink" title="Inexistent NULL in Solidity"></a>Inexistent NULL in Solidity</h3><p><strong>作者</strong>：孔令坤，<strong>转载请注明出处</strong></p>
<p>在Solidity中，并没有Null值的存在。所有的变量在初始化后都会被默认为0值。这导致我们在写代码的时候需要多加注意。</p>
<p>比如<a href="https://ohyoukillkenny.github.io/blog/01/03/LearnSolidity3/">之前</a>我遇到的<code>enum</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">enum State &#123; Created, Locked, Inactive &#125;</span><br><span class="line"><span class="comment">// Created = 0, Locked = 1, Inactive = 2</span></span><br></pre></td></tr></table></figure>
<p>之后，代码在没有对<code>myState</code>变量进行赋值的情况下，直接判断：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(myState == Created.Created);</span><br></pre></td></tr></table></figure>
<p>所以这个时系统断定判断通过，而且并不会报错。</p>
<p>那么，如何判断<code>mapping</code>中是否某个键是否”为空”呢？</p>
<p>比较标准的做法是建立一个专门和value相关的结构体，用一个布尔型变量来看是否这个key所对应的value被赋过值，代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">library Library &#123;</span><br><span class="line">  struct data &#123;</span><br><span class="line">     uint val;</span><br><span class="line">     bool isValue;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">contract myContract&#123;</span><br><span class="line">    using Library <span class="keyword">for</span> Library.data;</span><br><span class="line">    mapping(<span class="function"><span class="params">address</span> =&gt;</span> Library.data) cluster;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ifExist</span>(<span class="params">address id</span>) <span class="title">returns</span>(<span class="params">bool</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(cluster[id].isValue) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> flase; </span><br><span class="line">    &#125;</span><br><span class="line">  	<span class="function"><span class="keyword">function</span> <span class="title">addCluster</span>(<span class="params">address id</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(cluster[id].isValue) <span class="keyword">throw</span>; <span class="comment">// duplicate key</span></span><br><span class="line">        <span class="comment">// add ...</span></span><br><span class="line">      	cluster[id].isValue = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  	<span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此外，我们也可以简单的来看一下value所对应的length来判断这个值是否被赋值过（零值无法判断！）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mapping(<span class="function"><span class="params">address</span> =&gt;</span> uint) public deposits;</span><br><span class="line"><span class="keyword">if</span>(deposits[msg.sender].length == <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="comment">// deposit[msg.sender] is empty, do your thing</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果我们不用判断某个变量是否为赋过值后的零值时，我建议用第二种通过length来判断的方法，因为后者将大大减少合约gas的消耗。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ohyoukillkenny.github.io/blog/01/07/null-in-solidity/" data-id="cjficgnmg000u1gavspdxjjjr" class="article-share-link">Teilen</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/code/">code</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-start-solidity" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/01/04/start-solidity/" class="article-date">
  <time datetime="2018-01-04T12:26:02.000Z" itemprop="datePublished">2018-01-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/Learn-Solidity/">Learn Solidity</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/01/04/start-solidity/">Start with Solidity</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Ethereum-and-Solidity环境配置"><a href="#Ethereum-and-Solidity环境配置" class="headerlink" title="Ethereum and Solidity环境配置"></a>Ethereum and Solidity环境配置</h2><p><strong>作者</strong>：孔令坤，<strong>转载请注明出处</strong></p>
<p>由于Remix版本的更新，Metamask的更新已经Ethereum rinkeby network对Github账号申请eth的限制，我发现原来的<a href="https://karl.tech/learning-solidity-part-1-deploy-a-contract/" target="_blank" rel="noopener">配置教程</a>其实并不太适用于当前的版本了，所以在这里我简单的介绍一下开发的一些基本配置。在接下来的配置内容中，我借鉴了许多来自<a href="http://www.initc3.org/events/2017-07-13-IC3-Ethereum-Crypto-Boot-Camp-at-Cornell-University.html" target="_blank" rel="noopener">IC3 Ethereum/Cornell Bootcamp</a>的内容，主要对其中Github部分的内容做了更新。</p>
<h3 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements:"></a>Requirements:</h3><ul>
<li><a href="https://www.google.com/chrome/index.html" target="_blank" rel="noopener">Google Chrome</a></li>
<li><a href="https://twitter.com/" target="_blank" rel="noopener">Twitter Account</a></li>
<li><a href="https://metamask.io/" target="_blank" rel="noopener">Metamask</a></li>
</ul>
<h3 id="Introduction-of-Things"><a href="#Introduction-of-Things" class="headerlink" title="Introduction of Things:"></a>Introduction of Things:</h3><h4 id="Ethereum"><a href="#Ethereum" class="headerlink" title="Ethereum"></a><a href="http://ethdocs.org/en/latest/" target="_blank" rel="noopener">Ethereum</a></h4><p>Ethereum is an open-source, public, blockchain-based distributed computing platform featuring smart contract (scripting) functionality.</p>
<h4 id="Metamask"><a href="#Metamask" class="headerlink" title="Metamask"></a><a href="https://metamask.io/" target="_blank" rel="noopener">Metamask</a></h4><p>MetaMask is a bridge between Google Chrome and the Ethereum blockchain. It allows you to run Ethereum Dapps in your browser without running a full Ethereum node. MetaMask includes a secure identity vault, providing a user interface to manage your identities on different sites and sign blockchain transactions.</p>
<h4 id="Solidity"><a href="#Solidity" class="headerlink" title="Solidity"></a><a href="https://solidity.readthedocs.io/en/latest/" target="_blank" rel="noopener">Solidity</a></h4><p>Solidity is a programming language used to code smart contracts that are compatible with Ethereum. <a href="https://solidity.readthedocs.io/en/latest/" target="_blank" rel="noopener">The documentation for Solidity is located here</a>. We will be using <a href="https://ethereum.github.io/browser-solidity/" target="_blank" rel="noopener">Remix</a> when developing our smart contracts. Remix is an online development environment that allows you to code, deploy, and test smart contracts on the public Ethereum networks and test Ethereum networks.</p>
<h4 id="Rinkeby"><a href="#Rinkeby" class="headerlink" title="Rinkeby"></a><a href="https://www.rinkeby.io/" target="_blank" rel="noopener">Rinkeby</a></h4><p>Rinkeby is a public Ethereum test network that is used to deploy and test smart contracts for free. In order to receive Rinkeby ether coins, you will need to visit <a href="https://www.rinkeby.io/" target="_blank" rel="noopener">https://www.rinkeby.io/</a> once you have your Metamask client installed.</p>
<h3 id="Start-with-Ethereum-and-Solidity"><a href="#Start-with-Ethereum-and-Solidity" class="headerlink" title="Start with Ethereum and Solidity:"></a>Start with Ethereum and Solidity:</h3><p><strong>a. Setting up Metamask</strong></p>
<ol>
<li>Install the <a href="https://metamask.io/" target="_blank" rel="noopener">Metamask Chrome plugin</a>.</li>
<li>Open Metamask (there should be an orange fox icon in your browser toolbar).</li>
<li>Click through the license agreements.</li>
<li>Create a new “den” which will house your Ethereum account.</li>
<li>COPY THE 12 WORDS SOMEWHERE SAFE.</li>
<li>Click the network selection button on the top left part of the Metmask app. It should say “Ethereum Mainnet” or “Ropsten”. Change that to Rinkeby.</li>
<li>Copy your Ethereum account address by clicking the “Copy” icon above the “Buy” and “Send” buttons. Mouse over the icons to reveal their label.</li>
</ol>
<p><strong>b. Get Rinkeby Testnet Ether</strong></p>
<ol>
<li>Login into your <a href="https://twitter.com/" target="_blank" rel="noopener">Twitter account</a>.</li>
<li>Paste your Ethereum address you copied in step a.7 into the “What’s happening?” content boxs to make a new tweet. The Ethereum address should be a jumble of letters and numbers like this: <code>0x9bcd107A7De7C3cee1be15dFa06B5586672912e9</code></li>
<li>Click “Tweet” to gennerate a new Tweet.</li>
<li>Copy the URL of the Tweet. Click the button in the upper right of your tweet and select the option of “Copy link to Tweet”. The link should be similar to this:<code>https://twitter.com/316980786Kong/status/946989538890588161</code></li>
<li>Visit the <a href="https://www.rinkeby.io/" target="_blank" rel="noopener">Rinkeby website</a> and click “Crypto Faucet”.</li>
<li>Paste your Tweet URL in the box provided and click “Give me Ether - 3 ethers/8 hours”.</li>
<li>A box should pop up with with your Twitter icon indicating that your request for testnet ether is being processed.</li>
<li>Wait 10 seconds.</li>
<li>Look at your Metamask client and verify that you received 3 Rinkeby testnet ether.</li>
</ol>
<p><strong>c. Writing your first smart contract.</strong></p>
<ol>
<li>Go to the <a href="https://karl.tech/learning-solidity-part-2-voting/" target="_blank" rel="noopener">Learning Solidity Part 2: Commit-Reveal Voting</a>.</li>
<li>Walk through the blog and write your first smart contract.</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ohyoukillkenny.github.io/blog/01/04/start-solidity/" data-id="cjficgnml000y1gavpnh7k67x" class="article-share-link">Teilen</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/code/">code</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-LearnSolidity3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/01/03/LearnSolidity3/" class="article-date">
  <time datetime="2018-01-03T05:17:07.000Z" itemprop="datePublished">2018-01-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/Learn-Solidity/">Learn Solidity</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/01/03/LearnSolidity3/">Learn Solidity (3) — Safe Remote Purchase</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Solidity学习笔记-3-—-Safe-Remote-Purchase"><a href="#Solidity学习笔记-3-—-Safe-Remote-Purchase" class="headerlink" title="Solidity学习笔记(3) — Safe Remote Purchase"></a>Solidity学习笔记(3) — Safe Remote Purchase</h3><p><strong>作者</strong>：孔令坤，<strong>转载请注明出处</strong></p>
<p>今天用拍卖合约（Safe Remote Purchase）进行Smart Contract编程的学习。</p>
<p>今天的这一段代码，有一些比较tricky的地方，所以我的笔记也会比较详细。</p>
<p>附上官方的学习代码链接：<a href="https://solidity.readthedocs.io/en/latest/solidity-by-example.html#safe-remote-purchase" target="_blank" rel="noopener">https://solidity.readthedocs.io/en/latest/solidity-by-example.html#safe-remote-purchase</a></p>
<p>另外发现了一个不错的大纲型文档：<a href="https://medium.com/@mattcondon/getting-up-to-speed-on-ethereum-63ed28821bbe" target="_blank" rel="noopener">https://medium.com/@mattcondon/getting-up-to-speed-on-ethereum-63ed28821bbe</a></p>
<h4 id="1-功能简介"><a href="#1-功能简介" class="headerlink" title="1.功能简介"></a>1.功能简介</h4><p>这个合约作为一个第三方的平台，用于远程购买一个商品时暂存买方付的钱，然后在买方确认交易后将钱付给商家。整体而言这个合约相当于我们用淘宝网购时的淘宝平台，用户购买时将钱先付给淘宝平台，然后商家发货。用户在收到商品后在淘宝上确认付款，这时淘宝会把钱打给商户。</p>
<p>在使用这个合约时，卖方需要先自己创建(create)合约。整个流程与下图类似：</p>
<img src="/blog/01/03/LearnSolidity3/overview.png" title="Overview of Safe Remote Purchase Contract">
<h4 id="2-代码简介"><a href="#2-代码简介" class="headerlink" title="2.代码简介"></a>2.代码简介</h4><p><strong>初始函数</strong>：首先，我们看建立合约的初始函数，根据函数中的<code>payable</code>，说明这里发起协议的seller需要在transaction里面放价格为商品两倍的保证金。这里是整个合约最tricky的地方，即seller放了商品价格两倍的保证金。这样有两个目的，其一可以防止黑心商家，发起协议后不给用户发货，用户在确认后白白损失金额。其二可以让买方积极的去确认收到商品了，因为买方也要交商品价格两倍的保证金，如果不确认收到商品，他们将白白损失钱财。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">enum State &#123; Created, Locked, Inactive &#125;</span><br><span class="line">State public state;</span><br><span class="line"><span class="comment">// 这一段用require代码确认seller的value是偶数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Purchase</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">payable</span> </span>&#123;</span><br><span class="line">    seller = msg.sender;</span><br><span class="line">    value = msg.value / <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">require</span>((<span class="number">2</span> * value) == msg.value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其实这么写有浪费gas的问题。因为如果不是偶数，之前的语句已经执行过了，<code>require</code>导致函数回退时将会消耗更多的gas。所以我觉得这一段可以改成：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Purchase</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">payable</span> </span>&#123;</span><br><span class="line">    seller = msg.sender;</span><br><span class="line">    <span class="built_in">require</span>((msg.value % <span class="number">2</span>) == <span class="number">0</span>);</span><br><span class="line">    value = msg.value / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>另外神奇的是，在创建合约的函数里面，合约并没有写<code>state = State.Created;</code>然而在下面的<code>abort()</code>函数中，<code>inState(State.Created)</code>的判定竟然通过了。经过代码调试，我发现在<code>State public state;</code>这句话的时候，虽然没有直接赋值，但是系统默认state的值为空，在做<code>==</code>判定的时候，默认<code>state = 0</code>了。总之之后编程需要多多小心。PS. 我这里在调试的时候，加了一个<code>enum State { Created, Locked, Inactive }</code>然后创建了一个2eth的合约。于是我永久的丢掉了2eth。</p>
<p><strong>终止合约：</strong>在终止函数里，我想提一下<code>transfer</code>和<code>send</code>函数的区别。两者都是像地址传递钱，区别在于如果<code>transfer</code>函数运行失败，系统会throw一个错误，而<code>send</code>函数则会返回一个<code>false</code>的布尔值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">abort</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    <span class="title">public</span></span></span><br><span class="line"><span class="function">    <span class="title">onlySeller</span></span></span><br><span class="line"><span class="function">    <span class="title">inState</span>(<span class="params">State.Created</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Aborted();</span><br><span class="line">    state = State.Inactive;</span><br><span class="line">  	<span class="comment">// 这里把seller的保证金还给seller，里面应该是2V - gas fee</span></span><br><span class="line">    seller.transfer(<span class="keyword">this</span>.balance);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>确认支付：</strong> 这个函数由buyer在seller发起的协议基础上访问，会在协议里存两倍商品价格的钱，存完后会将Contract的状态标记为锁定, i,e., <code>Locked</code>。至于为何要付两倍的钱，我认为可能是因为这个协议担心用户会懒得确认到货，所以这么做来使得用户自己能够被</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">confirmPurchase</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    <span class="title">public</span></span></span><br><span class="line"><span class="function">    <span class="title">inState</span>(<span class="params">State.Created</span>)</span></span><br><span class="line"><span class="function">    <span class="title">condition</span>(<span class="params">msg.value == (<span class="number">2</span> * value</span>))</span></span><br><span class="line"><span class="function">    <span class="title">payable</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    PurchaseConfirmed();</span><br><span class="line">    buyer = msg.sender;</span><br><span class="line">    state = State.Locked;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>确认收货：</strong> 这个函数由buyer在seller发起的协议基础上访问，buyer确认收到商品，这样之后协议会把钱退回给buyer和seller。需要注意的是，这里官方代码认为所有的交易费用应该由seller承担。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">confirmReceived</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    <span class="title">public</span></span></span><br><span class="line"><span class="function">    <span class="title">onlyBuyer</span></span></span><br><span class="line"><span class="function">    <span class="title">inState</span>(<span class="params">State.Locked</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ItemReceived();</span><br><span class="line">    <span class="comment">// It is important to change the state first because</span></span><br><span class="line">    <span class="comment">// otherwise, the contracts called using `send` below</span></span><br><span class="line">    <span class="comment">// can call in again here.</span></span><br><span class="line">    state = State.Inactive;</span><br><span class="line">	<span class="comment">// 返回用户多余的押金，一倍商品价格</span></span><br><span class="line">    buyer.transfer(value);</span><br><span class="line">    <span class="comment">// 把剩下的 3V - gas fee的钱给商家。</span></span><br><span class="line">    seller.transfer(<span class="keyword">this</span>.balance);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-一些思考"><a href="#3-一些思考" class="headerlink" title="3.一些思考"></a>3.一些思考</h4><p>在看代码的过程中，我发现这个合约有一个无法解决的问题。</p>
<p>假如有一些恶意的用户想搞垮商家，于是买了商品后就是不确认，这样用户通过损失等价于一个商品价格的费用（因为用户其实收到了商品），就可以坑掉商家三倍商品价格的钱（商家发出了商品）。</p>
<p>其实这个问题的本质源于smart contract无法监管商品的运转，即它无法发现假如钱被锁死在了合约里面，是谁干了坏事。所以我觉得就remote purchace这个问题而言，比较理想的状况还是得有一个买卖双方都信的过的第三方机构介入其中。buyer先把钱寄给这个第三方机构，然后由第三方机构作为仲裁方，决定把钱最终交给buyer还是seller。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ohyoukillkenny.github.io/blog/01/03/LearnSolidity3/" data-id="cjficgnll00031gavf559vmt9" class="article-share-link">Teilen</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/code/">code</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/blog/page/2/">&laquo; zurück</a><a class="page-number" href="/blog/">1</a><a class="page-number" href="/blog/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/blog/page/4/">4</a><a class="page-number" href="/blog/page/5/">5</a><a class="extend next" rel="next" href="/blog/page/4/">weiter &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Algorithms/">Algorithms</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Learn-Solidity/">Learn Solidity</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/articles/">articles</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Code/">Code</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/code/">code</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/code-tools/">code tools</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/blog/tags/Code/" style="font-size: 10px;">Code</a> <a href="/blog/tags/code/" style="font-size: 20px;">code</a> <a href="/blog/tags/code-tools/" style="font-size: 10px;">code tools</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/01/">January 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/04/02/boyfriend/">How to find the Mr. Right</a>
          </li>
        
          <li>
            <a href="/blog/03/27/Web3-Solidity/">Web3-Solidity</a>
          </li>
        
          <li>
            <a href="/blog/03/24/LearnSolidity4/">LearnSolidity4 — CrowdSensing</a>
          </li>
        
          <li>
            <a href="/blog/02/06/hanoi/">Hanoi in Assembly x86 (NASM)</a>
          </li>
        
          <li>
            <a href="/blog/02/06/DNA-min-mismatch/">Needleman–Wunsch algorithm</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Lingkun Kong<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">
  <script src="/blog/fancybox/jquery.fancybox.pack.js"></script>


<script src="/blog/js/script.js"></script>



  </div>
</body>
</html>