<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  

  
  <title>Lingkun&#39;s Small House</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Lingkun&#39;s Small House">
<meta property="og:url" content="https://ohyoukillkenny.github.io/blog/index.html">
<meta property="og:site_name" content="Lingkun&#39;s Small House">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lingkun&#39;s Small House">
  
    <link rel="alternate" href="/blog/atom.xml" title="Lingkun&#39;s Small House" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/blog/css/style.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">Lingkun&#39;s Small House</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/blog/" id="subtitle">In me the tiger sniffs the rose.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://ohyoukillkenny.github.io/blog"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-LearnSolidity5" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/04/11/LearnSolidity5/" class="article-date">
  <time datetime="2018-04-11T02:44:20.000Z" itemprop="datePublished">2018-04-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/Learn-Solidity/">Learn Solidity</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/04/11/LearnSolidity5/">Project — Building a Simple Blockchain-based Crowdsensing System</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Project-—-Building-a-Simple-Blockchain-based-Crowdsensing-System"><a href="#Project-—-Building-a-Simple-Blockchain-based-Crowdsensing-System" class="headerlink" title="Project — Building a Simple Blockchain-based Crowdsensing System"></a>Project — Building a Simple Blockchain-based Crowdsensing System</h3><p><strong>Author:</strong> Lingkun Kong, <a href="http://wirelesslab.sjtu.edu.cn/~klh/" target="_blank" rel="noopener">Linghe Kong</a>,  <strong>Please indicate the source for reproduction.</strong></p>
<h4 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h4><p>Motivated by constructing a crowd-sensing system with security and low services fee, we propose building a blockchain-based crowd-sensing framework that replaces traditional triangle architecture by decentralized blockchain system. Also, in order to accelerate the formation of the fabric of trust, instead of releasing a new virtual currency, the proposed framework implements applications of smart contracts to reward sensing-task workers which offers reliable anonymity. Also, by leveraging blockchain technology in crowd-sensing, the proposed framework is also an exploration on the mining puzzles of proof-of-usefulness.</p>
<h4 id="Background-and-Motivation"><a href="#Background-and-Motivation" class="headerlink" title="Background and Motivation"></a>Background and Motivation</h4><p>Crowd-sensing systems, which take advantage of pervasive mobile devices to efficiently collect data, have gained considerable interest and adoption in recent years [1][2].  However, the majority of existing crowd-sensing systems rely on central servers, which are subject to the weaknesses of the traditional trust-based model, such as single point of failure and privacy disclosure [3][4].  They are also vulnerable to distributed denial of service (DDoS) and Sybil attacks due to malicious users’ involvement [5]. In addition, high service fees charged by the crowd-sensing platform which has monopolized the market may stem the development of crowd-sensing. How to address these potential issues remains to be an open problem.</p>
<p>There have been several studies to deal with part of the aforementioned open problem [6-10], while the majority of these researches are built on the traditional triangular structure crowd-sensing models, which suffer from breakdown of trust. Thus, this research proposal is motivated by this: <em>Can we design a decentralized crowd-sensing system with security and low services fee?</em></p>
<h4 id="Introduction-of-Blockchain-based-Crowd-sensing-System"><a href="#Introduction-of-Blockchain-based-Crowd-sensing-System" class="headerlink" title="Introduction of Blockchain-based Crowd-sensing System"></a>Introduction of Blockchain-based Crowd-sensing System</h4><p>The past few years have witnessed the emergence of blockchain as well as its multiple applications [11,12,16,17,19,22], which provides us an opportunity to solve all of the above issues in crowd-sensing systems simultaneously. Therefore, I propose building a blockchain-based decentralized framework for crowd-sensing, with the purpose of alleviating privacy leakage and reducing the charge of the central platform.</p>
<p>To illustrate, by leveraging blockchain architecture, we can replace the centralized crowd-sensing platform by decentralized blockchain system. Therefore, the services fee charged by the platform can be used more efficiently, as it now is all paid to workers and blockchain miners [14]. Also, since now the crowd-sensing process does not depend on any central third party, there is no single point of failure issue. Besides, for the sake of properties of blockchain, we can guarantee privacy by allowing users to register without true identity and storing encrypted sensory data in the distributed database. Further, by stipulating that each identity must make a deposit before participation in smart contract protocols, we can efficiently prevent various attacks (e.g. DDoS, Sybil and “false-reporting” attacks [13]).</p>
<p>In the context of blockchain applications, current prevalent blockchain-based systems such as Bitcoin [11], Litecoin [16], and Zcash [17], etc., always issue virtual currencies to incentivize miners and try to convince both miners and users that the virtual currency is worthy of being hold. However, to earn the trust from users and maintain the fabric of trust are quite difficult. Also, legal problems always ensue the issue of virtual currencies, and Governments worry about the high anonymity within currency systems will found the breeding ground for the crime [18]. When dealing with crowd-sensing problems, it is unrealistic to quickly build the reputation of the system and win the trust from users by issuing new virtual currencies. Additionally, with the awareness of legal issues, it is impractical to universally apply systems which release the virtual currency. </p>
<p>Moreover, in traditional blockchain-based systems, there’s a concern that Bitcoin mining is extremely profligate, since massive energy is wasted by miners in solving “useless” puzzles for block discovery [21]. Thus, “Is there a puzzle, whose solution provides useful benefit to society, while still satisfying the basic requirements of Blockchain puzzles?” is raised to be a natural question. There have been several studies which attempted to reduce blockchain-based system’s energy waste, such as Primecoin and Permacoin [19,22]. However, their methods are not feasible for a lot of potential candidates such as problems of protein folding [23], space signal searching [20], which are of great scientific usefulness while needs a trusted administrator. In this case, building a blockchain-based crowd-sensing framework will also be an exploration of the proof-of-usefulness puzzle, which might be helpful to reduce the energy waste in traditional blockchain systems.</p>
<p>Faced with these challenges, in our proposed framework, we introduce applications of smart contracts to reward users, which should be first initiated by sensing-task requesters with certain reserve money. On the one hand, by this method, we can build the reputation of the framework and raise the enthusiasm of both miners and workers in a short time. On the other hand, since there is deposit in the smart contract, and the methods of getting rewards are substantiated by published smart contract, both requesters and workers can trust the immutable codes from published smart contract as a credible administrator. Therefore, the new framework will be feasible for broad implementation of proof-of-usefulness puzzles.</p>
<p>Specifically, the traditional crowd-sensing process consists of three groups of roles: requesters, workers and a centralized crowd-sensing system, where requesters submit tasks to the system and receive sensing results from the system; workers pull tasks from the system, complete tasks they interested in and submit sensing results to the system; the centralized system deals with submissions from requesters and workers and responds them accordingly. Figure below presents the crowd-sensing by traditional centralized systems.</p>
<img src="/blog/04/11/LearnSolidity5/tradi.png" title="The system model of traditional crowd-sensing.">
<p>In the blockchain-based decentralized system which we propose, there is no centralized platform in crowd-sensing process anymore. Instead, by leveraging blockchain techniques, the crowd-sensing process is managed by a decentralized system, which is presented in Figure below.</p>
<img src="/blog/04/11/LearnSolidity5/advanced.png" title="The system model of blockchain-based crowd-sensing.">
<p>Basically, the crowd-sensing process can be divided into following steps:</p>
<p><strong>Step1:</strong> Requesters post tasks, and, meanwhile, they need to initialize the examining rules and send to communication platform, which, in our design, actually is to publish a smart contract and then create the function in smart contract. </p>
<p><strong>Step2:</strong> Workers, by querying blockchain and fetching message from communication platform, i.e., querying the published smart contract, obtain attractive sensing tasks. After finishing tasks by recording sensing data, they post the message to the communication platform, i.e., call specific functions in smart contracts.</p>
<p><strong>Step3:</strong> By querying blockchain and listening to the communication platform, miners fetch unsubstantiated sensing data, and they can examine the quality of this data based on rules the requester establishes. After miners substantiate the quality of sensing data, they will get the reward after pushing processed sensing data into blocks. In general, miners obtain reward by contributing computing power for running smart contracts.</p>
<p><strong>Step4:</strong> Requesters listen to the blockchain periodically. Once they are satisfied with sensed data or decide to not continue collecting data for other reasons, they can send message to the system to burn the blockchain and get the remained reserve money from smart contract. As this message will be broadcasted in the system, miners and workers will then cease to work.</p>
<h4 id="Detailed-Implementation-of-Smart-Contract"><a href="#Detailed-Implementation-of-Smart-Contract" class="headerlink" title="Detailed Implementation of Smart Contract"></a>Detailed Implementation of Smart Contract</h4><p>Additionally, we propose to add applications of smart contracts over the whole framework with the purpose of quickly obtaining users’ trust and making the design feasible for various purposes, such as aforementioned problems of protein folding and aliens discovery. Figure below shows the structure of decentralized system after adding smart contracts.</p>
<img src="/blog/04/11/LearnSolidity5/smartcontract.png" title="The system model of blockchain-based crowd-sensing after adding the controller of smart contracts.">
<p>In this figure, the number indicates the order of the operation in a certain crowd-sensing task, where operation 3* means this operation can be processed concurrently with operation 3, and operation mark x means this operation can be undertaken in any time after operation 2. Moreover, the solid lines in the figure stand for operations being necessarily done in a certain task, while the unfilled lines indicate these operations might not be properly processed.</p>
<p>In this system,  the requester enters in the system and create the smart contract by setting requirements for sensing data and stores a certain amount of deposits for determining the rewards. After that, once workers are attracted by the rewards as well as their data are substantiated by miners, they can get rewards stored in the smart contract protocol right away. Therefore, the reputation of this system can be quickly built, and the enthusiasm of both miners and workers can be aroused as once they got works done, they can receive valuable rewards. Also, since rules are “printed” in the smart contract, both workers and miners can trust the published smart contract as a credible administrator. Therefore, the challenge of lacking trusted administrators for puzzles like protein folding and space signal searching is overcome in this proposed framework. </p>
<p><strong>Remarks:</strong> The submission of collected data will cost workers certain amount of gas in smart contract. In fact, it is tantamount for workers to make security deposits before participation in crowd-sensing task, which efficiently prevents various attacks (e.g. DDoS, Sybil and “false-reporting” attacks [13]).</p>
<h4 id="Using-an-Simple-Example-to-Show-How-the-System-Works"><a href="#Using-an-Simple-Example-to-Show-How-the-System-Works" class="headerlink" title="Using an Simple Example to Show How the System Works"></a>Using an Simple Example to Show How the System Works</h4><p>Here, we use a simple wifi-sensing task to show how the system works.</p>
<p>First of all, we present the source code of smart contract of wifi-sensing.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.21</span>;</span><br><span class="line"></span><br><span class="line">contract SensingWifi&#123;</span><br><span class="line">    uint public rewardUnit;</span><br><span class="line">    uint public rewardNum;</span><br><span class="line">    uint public dataCount;</span><br><span class="line">    bytes32 public wifiName;</span><br><span class="line">    address public requester;</span><br><span class="line">    enum State &#123;Uncreated, Created, Inactive&#125;</span><br><span class="line">    State public state;</span><br><span class="line"></span><br><span class="line">    mapping(<span class="function"><span class="params">bytes32</span> =&gt;</span> string) dataStatuses; <span class="comment">// Either '' or 'Committed'</span></span><br><span class="line"></span><br><span class="line">    modifier condition(bool _condition) &#123;</span><br><span class="line">        <span class="built_in">require</span>(_condition);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier onlyRequester() &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.sender == requester);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier inState(State _state) &#123;</span><br><span class="line">        <span class="built_in">require</span>(state == _state);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    event Aborted();</span><br><span class="line">    event TaskInited(uint ru, uint rn, bytes32 wn);</span><br><span class="line">    event ViewTask(uint ru, uint rn, bytes32 wn, uint cnt);</span><br><span class="line">    event DataCommited(bytes32 l, bytes32 w, int s);</span><br><span class="line">    event TaskDone();</span><br><span class="line">    event dataCheck(uint cnt);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Init the task as requster.</span></span><br><span class="line">    <span class="comment">// The requster need to set the value of reward for each sensing data,</span></span><br><span class="line">    <span class="comment">// as well as the maximum number of data he needed.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">initTask</span>(<span class="params">uint _rewardUnit, uint _rewardNum, bytes32 _wifiName</span>)</span></span><br><span class="line"><span class="function">        <span class="title">public</span></span></span><br><span class="line"><span class="function">        <span class="title">inState</span>(<span class="params">State.Uncreated</span>)</span></span><br><span class="line"><span class="function">        <span class="title">condition</span>(<span class="params">msg.value &gt;= _rewardUnit * _rewardNum</span>)</span></span><br><span class="line"><span class="function">        <span class="title">payable</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        requester = msg.sender;</span><br><span class="line">        rewardUnit = _rewardUnit;</span><br><span class="line">        rewardNum = _rewardNum;</span><br><span class="line">        wifiName = _wifiName;</span><br><span class="line">        state = State.Created;</span><br><span class="line">        emit TaskInited(_rewardUnit, _rewardNum, _wifiName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Abort the Task and reclaim the ether,</span></span><br><span class="line">    <span class="comment">// Can only be called by the requester.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">abort</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        <span class="title">public</span></span></span><br><span class="line"><span class="function">        <span class="title">onlyRequester</span></span></span><br><span class="line"><span class="function">        <span class="title">inState</span>(<span class="params">State.Created</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(dataCount &lt;= rewardNum);</span><br><span class="line">        state = State.Inactive;</span><br><span class="line">        requester.transfer(<span class="keyword">this</span>.balance);</span><br><span class="line">        emit Aborted();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getDataCnt</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        <span class="title">public</span></span></span><br><span class="line"><span class="function">        <span class="title">onlyRequester</span></span></span><br><span class="line"><span class="function">        <span class="title">inState</span>(<span class="params">State.Created</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        emit dataCheck(dataCount);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Worker answer the task by sending data</span></span><br><span class="line">    <span class="comment">// such as &#123;"41-24-12.2-N 2-10-26.5-E", "SJTU", -51&#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getTask</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        <span class="title">public</span></span></span><br><span class="line"><span class="function">        <span class="title">inState</span>(<span class="params">State.Created</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        emit ViewTask(rewardUnit, rewardNum, wifiName, dataCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">commitTask</span>(<span class="params">bytes32 _location, bytes32 _wifiName, int _signalDegree</span>)</span></span><br><span class="line"><span class="function">        <span class="title">public</span></span></span><br><span class="line"><span class="function">        <span class="title">inState</span>(<span class="params">State.Created</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(dataCount &lt; rewardNum);</span><br><span class="line">        bytes memory sensingDataCommit = bytes(dataStatuses[_location]);</span><br><span class="line">        <span class="comment">// Requester wants to get data from different location</span></span><br><span class="line">        <span class="built_in">require</span>(sensingDataCommit.length == <span class="number">0</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Make sure that the wifi signal sensed is what requester wants</span></span><br><span class="line">        <span class="built_in">require</span>(wifiName==_wifiName);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// The theoretical maximum value of signal strength is -30 dBm</span></span><br><span class="line">        <span class="built_in">require</span>(_signalDegree &lt; <span class="number">-30</span>);</span><br><span class="line">        </span><br><span class="line">        dataStatuses[_location] = <span class="string">"Committed"</span>;</span><br><span class="line">        </span><br><span class="line">        dataCount += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(dataCount == rewardNum)&#123;</span><br><span class="line">            state = State.Inactive;</span><br><span class="line">            requester.transfer(<span class="keyword">this</span>.balance);</span><br><span class="line">            emit TaskDone();</span><br><span class="line">        &#125;</span><br><span class="line">        msg.sender.transfer(rewardUnit);</span><br><span class="line">        emit DataCommited(_location, _wifiName, _signalDegree);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Functions for Requesters:</strong></p>
<p>For requesters, they are the initiators of the wifi-sensing tasks. Therefore, they have responsibilities to write the smart contract and initiate the wifi-sensing task.</p>
<p><strong><code>initTask()</code></strong>: Requesters can call the <code>initTask()</code> function to create a wifi-sensing task and determine the rewards for each processed sensing data. In this function, requesters need to save certain amount of deposits in the smart contract and specify the value of each reward as well as the maximum number of data required.</p>
<p><strong><code>abort()</code></strong>: Requesters have the rights to abort the task once they believe they have collected enough data by viewing the number of data in <code>getDataCnt()</code>. This function will give requesters refunds of their deposits.</p>
<p>Also, we developed a simple interface for users to play the role as requesters, and figure below is the screenshot of the interface.</p>
<img src="/blog/04/11/LearnSolidity5/requesterInterface.png" title="The screenshot of requester interface after a requster creating a wifi-sensing task.">
<p>Here, users, playing as requesters, create a wifi-sensing task by setting <em>Value of Each Reward</em> as 100000000 wei, <em>number of Data Required</em> as 5 and <em>wifi name</em> as SJTU. Similarly, users can abort the task and check the current status of the task by click buttons of <strong>Abort</strong> and <strong>Check</strong>. The text beneath the title of <strong>Wifi Sensing — Requester</strong> will present corresponding information.</p>
<p><strong>Functions for Workers:</strong></p>
<p>For workers, they choose the tasks they are interested in and submit data for this tasks. Here we assume that workers are interested in the wifi-sensing task and try to work for it.</p>
<p><strong><code>commitTask()</code></strong>: Workers call this function to submit their collected data. Before they submit their data, they need to watch carefully about the requirements of the data “enacted” by the requesters as they are writers of <code>commitTask()</code> function. Here, for example, requesters need the data of wifi signal which are collected from different places, named as SJTU and measured to be restricted in a conscionable range. To be noticed, if data submitted by the workers do not meet the requirements, workers cannot receive a single penny from their work but waste money in paying the transaction fee, i.e., gas to miniers. Therefore, workers need to be really careful when trying to submitting the data, and it is always a good idea for workers to call <code>getTask()</code> function first though a little amount of gas fee will be costed (about 0.00011 ETH ~ 0.05 USD in 04/11/2018).</p>
<p>We also provide a simple interface for workers to submit their data and get reward.</p>
<img src="/blog/04/11/LearnSolidity5/workerview.png" title="The screenshot of worker interface after a worker clicking the View Task button.">
<p>This figure is about the screenshot of worker interface after a worker clicking the <strong>View Task</strong> button.</p>
<img src="/blog/04/11/LearnSolidity5/workersubmit.png" title="The screenshot of worker interface after a worker commits his data.">
<p>This figure presents the screenshot of worker interface after a worker submits his data by clicking <strong>Commit</strong> button.</p>
<p>The interesting thing is that as in this example, the requester sets 100000000 wei (about 0.00000000001 ETH) as the value of each reward, which is much smaller than the costs of gas fee the worker pay for calling <code>commitTask()</code> and <code>getTask()</code> function (about 0.00046 ETH). Therefore, the worker fells into the trap set by the requester — the worker works for requester and loses money. In other words, the worker actually needs to be really careful when calling <code>getTask()</code> to view the reward of each data, since he can only earn money as long as the reward of each collected data is larger than transaction fees paid to hidden miniers (in this case, the reward should be larger than 0.00046 ETH).</p>
<p><strong>Remarks for Miners:</strong> The miners are hidden behind the smart contract, and they earn money by contributing their computing power to run the complied program in smart contracts. Actually, both requesters and workers pay for miners by providing gas fee.</p>
<p>The source code of smart contract as well as the interfaces has been published on the webpage: <a href="https://github.com/Ohyoukillkenny/BCS" target="_blank" rel="noopener">https://github.com/Ohyoukillkenny/BCS</a></p>
<h4 id="Analysis-of-the-Blockchain-based-Crowd-sensing-System"><a href="#Analysis-of-the-Blockchain-based-Crowd-sensing-System" class="headerlink" title="Analysis of the Blockchain-based Crowd-sensing System"></a>Analysis of the Blockchain-based Crowd-sensing System</h4><p>In this part, we briefly analyze our blockchain-based crowd-sensing system from the aspects of security and the financial efficiency.</p>
<p><strong>Security:</strong></p>
<ol>
<li>By implementing smart contracts, the anomynity of workers as well as requesters can be highly assured, since they only know the ETH accounts of each others. Also, for workers, if they believe their collected data may include several private information which make them uncomfortable to share, they can directly refuse to submit the data.</li>
<li>As we have mentioned in the <em>Remark</em> of <em>Introduction of Blockchain-based Crowd-sensing System</em>, workers actually need to make security deposits, i.e., pay transaction fees to miners, before participation in crowd-sensing task, which efficiently prevents various attacks (e.g. DDoS, Sybil and “false-reporting” attacks [13]).</li>
<li>One potential attack of our system is so called <strong>front-run attacking</strong>, which has been leveraged in attacking Bancor protocol [27]. In our schema, attackers can use front-run attacking to steal the rewards which are supposed to provide to workers. To illustrate, attackers always listen to the network , fetch the submitted data from workers and then submit these data immediately. Since many crowd-sensing tasks require the uniqueness of the data and the attacker has chances to get submitted data substantiated by miners earlier, the “real” worker might not be able to get his reward as expected. However, there has been several solutions which we can refered to avoid this attack, even in the article [27] which discovered the front-run attacking toward applications of smart contracts. In fact, in our system, we can simply spread rumors among the networks to prevent this attack. That is we can submit a lot of invalid data to the smart contract while not confirm it, otherwise we will waste transaction fee. When attackers fetch these rumor message, they, however, will directly submit this message and waste a large bunch of money. Therefore, the attacking will be stemed.</li>
</ol>
<p><strong>Financial Efficiency:</strong></p>
<p>The minimum cost of requesters for each data largely depends on the cost of transaction fee workers need to pay. This is because if the reward for each data cannot cover the transaction fee workers need to pay for submitting the data, no one will be willing to work for the requester.</p>
<p>Therefore, using the wifi-sensing task as an instance, we use the table below to briefly count the average cost of transaction fees workers need to pay by lauching experiments of the participation of 1000 workers.</p>
<table>
<thead>
<tr>
<th>Cost of <code>getTask()</code> Call</th>
<th>Cost of <code>commitTask()</code> Call</th>
<th>Size of the Data</th>
<th>avg Total Cost</th>
</tr>
</thead>
<tbody>
<tr>
<td>0.00011 ETH</td>
<td>0.00041 ETH</td>
<td>97.8 bytes</td>
<td>0.00052 ETH</td>
</tr>
</tbody>
</table>
<p>Due to the violent fluctuation of the price of ETH, it is hard to evaluate the value of 0.00052 ETH in real-world market. Here we use the exchange rate between USD and ETH in 04/11/2018 [28] to roughly estimate the the value of 0.00052 ETH as 0.217 USD, which means that requesters need to pay each wifi-sensing data for at least 0.217 USD.</p>
<p>This value might be too high for a simple wifi-sensing task. However, when the data the requester attempts to collect are essentially sensitive and require high anonymity, e.g., personal income, medical history and etc., this price might be totally acceptable. After all, the key advantage of decentralized crowdsensing system is to break the control of centralized data manage system as well as the monopoly price of data-sensing task. We hope our blockchain-based crowd-sensing system can offer users an another option when try to participate in crowd-sensing tasks.</p>
<h4 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h4><p>To sum up, in this article, we propose building a blockchain-based crowd-sensing to make up for the paucity of decentralized crowd-sensing systems with security and low services fee. Since we are still in the early stage of blockchain technology, this project will be of importance to research in distributed systems by providing a concrete blockchain-based solution for a known scientific problem, i.e., crowd-sensing management.</p>
<h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><blockquote>
<p>[1] Ma, H., Zhao,D., &amp; Yuan, P. (2014). Opportunities in mobile crowd sensing. IEEECommunications Magazine, 52(8), 29-35.</p>
<p>[2] Zhang, X.,Yang, Z., Sun, W., Liu, Y., Tang, S., Xing, K., &amp; Mao, X. (2016).Incentives for mobile crowd sensing: A survey. IEEE Communications Surveys&amp; Tutorials, 18(1), 54-67.</p>
<p>[3]Vergara-Laurens, I. J., Jaimes, L. G., &amp; Labrador, M. A. (2016).Privacy-preserving mechanisms for crowdsensing: Survey and researchchallenges. IEEE Internet of Things Journal.</p>
<p>[4] Pournajaf, L.,Xiong, L., Garcia-Ulloa, D. A., &amp; Sunderam, V. (2014). A survey on privacyin mobile crowd sensing task management. Tech. Rep. TR-2014–002.</p>
<p>[5] Krontiris, I.,Langheinrich, M., &amp; Shilton, K. (2014). Trust and privacy in mobileexperience sharing: future challenges and avenues for research. IEEECommunications Magazine, 52(8), 50-55.</p>
<p>[6] Cardone, G.,Foschini, L., Bellavista, P., Corradi, A., Borcea, C., Talasila, M., &amp;Curtmola, R. (2013). Fostering participaction in smart cities: a geo-socialcrowdsensing platform. IEEE Communications Magazine, 51(6), 112-119.</p>
<p>[7] Cardone, G.,Cirri, A., Corradi, A., &amp; Foschini, L. (2014). The participact mobile crowdsensing living lab: The testbed for smart cities. IEEE CommunicationsMagazine, 52(10), 78-85.</p>
<p>[8] Hamm, J.,Champion, A. C., Chen, G., Belkin, M., &amp; Xuan, D. (2015, June). Crowd-ML: Aprivacy-preserving learning framework for a crowd of smart devices.In Distributed Computing Systems (ICDCS), 2015 IEEE 35th InternationalConference on (pp. 11-20). IEEE.</p>
<p>[9] Jayarajah, K.,Balan, R. K., Radhakrishnan, M., Misra, A., &amp; Lee, Y. (2016, June).LiveLabs: Building In-Situ Mobile Sensing &amp; Behavioural ExperimentationTestBeds. In Proceedings of the 14th Annual International Conference onMobile Systems, Applications, and Services (pp. 1-15). ACM.</p>
<p>[10] Han, G., Liu,L., Chan, S., Yu, R., &amp; Yang, Y. (2017). HySense: A Hybrid MobileCrowdSensing Framework for Sensing Opportunities Compensation under DynamicCoverage Constraint. IEEE Communications Magazine, 55(3), 93-99.</p>
<p>[11] Nakamoto, S.(2015). Bitcoin: A Peer-to-Peer Electronic Cash System. November 2008.</p>
<p>[12] Swan, M.(2015). Blockchain: Blueprint for a new economy. “ O’Reilly Media,Inc.”.</p>
<p>[13] Zhang, X.,Xue, G., Yu, R., Yang, D., &amp; Tang, J. (2015). Keep your promise: Mechanismdesign against free-riding and false-reporting in crowdsourcing. IEEEInternet of Things Journal, 2(6), 562-572.</p>
<p>[14] Li, M., Lu,W., Weng, J., &amp; Yang, A. (2017). CrowdBC: A Blockchain-based DecentralizedFramework for Crowdsourcing. IACR Cryptology ePrint Archive, 2017, 444.</p>
<p>[15] <a href="https://en.wikipedia.org/wiki/PayPal" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/PayPal</a></p>
<p>[16] Greenberg, A.(2016). Zcash, an untraceable bitcoin alternative, launches in alpha.</p>
<p>[17] Lee, C.(2011). Litecoin.</p>
<p>[18]<a href="http://www.gov.cn/gzdt/2013-12/05/content_2542751.htm" target="_blank" rel="noopener">http://www.gov.cn/gzdt/2013-12/05/content_2542751.htm</a></p>
<p>[19] King, S.(2013). Primecoin: Cryptocurrency with prime number proof-of-work. July7th.</p>
<p>[20] <a href="https://setiathome.berkeley.edu/" target="_blank" rel="noopener">https://setiathome.berkeley.edu/</a></p>
<p>[21] <a href="https://motherboard.vice.com/en_us/article/aek3za/bitcoin-could-consume-as-much-electricity-as-denmark-by-2020" target="_blank" rel="noopener">https://motherboard.vice.com/en_us/article/aek3za/bitcoin-could-consume-as-much-electricity-as-denmark-by-2020</a></p>
<p>[22] Miller, A.,Juels, A., Shi, E., Parno, B., &amp; Katz, J. (2014, May). Permacoin:Repurposing bitcoin work for data preservation. In Security and Privacy(SP), 2014 IEEE Symposium on (pp. 475-490). IEEE.</p>
<p>[23] Dill, K. A.,&amp; MacCallum, J. L. (2012). The protein-folding problem, 50 yearson. science, 338(6110), 1042-1046.</p>
<p>[24] Ron Rivest,<br>Leonard Adleman, and Michael L. Dertouzos. On data banks and privacy<br>homomorphisms. Foundations of Secure Computation, 1978.<br>[25] Craig Gentry. Fully homomorphic encryption using ideal lattices. STOC<br>\2009. Also, see “A fully homomorphic encryption scheme”, PhD thesis, Stanford<br>University, 2009.<br>[26] Jake Loftus, Alexander May, Nigel P. Smart, and Frederik Vercauteren. On<br>CCA-Secure Fully Homomorphic Encryption. Cryptology ePrint Archive 2010/560.</p>
<p>[27] <a href="https://hackernoon.com/front-running-bancor-in-150-lines-of-python-with-ethereum-api-d5e2bfd0d798" target="_blank" rel="noopener">https://hackernoon.com/front-running-bancor-in-150-lines-of-python-with-ethereum-api-d5e2bfd0d798</a></p>
<p>[28] <a href="https://coinmarketcap.com/" target="_blank" rel="noopener">https://coinmarketcap.com/</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ohyoukillkenny.github.io/blog/04/11/LearnSolidity5/" data-id="cjfuybrzr0006c7avbmacuyz4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/projects-code/">projects, code</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-boyfriend" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/04/02/boyfriend/" class="article-date">
  <time datetime="2018-04-02T14:41:06.000Z" itemprop="datePublished">2018-04-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/Algorithms/">Algorithms</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/04/02/boyfriend/">How to find the Mr. Right</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="How-to-find-the-Mr-Right"><a href="#How-to-find-the-Mr-Right" class="headerlink" title="How to find the Mr. Right"></a>How to find the Mr. Right</h3><p><strong>作者</strong>：孔令坤，<strong>转载请注明出处</strong></p>
<p>青春苦短，一个女性的青春假设为18到28岁，在10年期间内每半年假设可以找到一个男友，那么在这20次尝试的过程中应当采取怎样的策略才能从理论上找到Mr. Right呢？</p>
<h4 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h4><ol>
<li>好马不吃回头草，优秀的妹子才不和前任继续往来。</li>
<li>每找到一个新的男友后，妹子可以根据其综合表现进行评分。</li>
</ol>
<h4 id="策略"><a href="#策略" class="headerlink" title="策略"></a>策略</h4><p>假设尝试次数为n，妹子们可以在找完k个男友后，抛弃掉他们，然后选取这k个人中最高的综合评分，记为bestScore。</p>
<p>在之后的找男友大作战中，只要有人的综合评分大于bestScore，妹子就可以赶紧选择他。</p>
<p>接下来，我们需要从概率学的角度来计算，k取何值时，妹子可以在第k+1次选取中最大概率地选到n次尝试机会里分数最高的男友，即在k+1次时找到人群中最优秀的男友。</p>
<h4 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># this function returns the index of the MrRight when having n shots</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findMrRight</span><span class="params">(k,n)</span>:</span></span><br><span class="line">  bestScore = <span class="number">-1</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(k):</span><br><span class="line">    <span class="keyword">if</span> score(i) &gt; bestScore:</span><br><span class="line">      bestScore = score(i)</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(k,n):</span><br><span class="line">    <span class="keyword">if</span> score(i) &gt; bestScore:</span><br><span class="line">      <span class="keyword">return</span> i</span><br><span class="line">  <span class="keyword">return</span> n</span><br></pre></td></tr></table></figure>
<h4 id="概率分析"><a href="#概率分析" class="headerlink" title="概率分析"></a>概率分析</h4><p>记$S$为妹子成功的选择到了Mr. Right的事件，$S_i$表示Mr. Right是第$i$个男友时成功的事件，即$k&lt;i\leq n$时妹子找到了Mr. Right。由于不同的$S<em>i$不相交，于是我们有：<br>$$<br>\text{Pr}(S) = \sum</em>{i=k+1}^{n}\text{Pr}(S_i)<br>$$<br>接下来我们来计算$\text{Pr}(S_i)$。为了使在第$i$个男友时找到Mr. Right，有两件事情必须发生：</p>
<ol>
<li>Mr. Right必须在第$i$次被找到，即所有$n$个男性中分数最高的男性在妹子的第$i$次尝试中被发现——记此事件为$A_i$。</li>
<li>妹子不能选择在第$k+1$到第$i-1$次尝试中的男友，即在第1次到第$i-1$次尝试中，综合评分最高的男友需要出现在前$k$次中——记此事件为$B_i$。</li>
</ol>
<p>对于事件$A_i$，其相当于$n$个男性中分数最高的男性落在了第$i$个位置上，概率有$\text{Pr}(A_i)=\frac{1}{n}$。</p>
<p>对于事件$B_i$，其相当于$i-1$个男性中分数最高的男性落在了位置$1,2,…,k-1,k$中的某个位置，概率满足$\text{Pr}(B_i)=\frac{k}{i-1}$。</p>
<p>由于事件$A_i$、事件$B<em>i$相互独立，我们发现：<br>$$<br>\begin{align}<br>\text{Pr}(S) &amp; = \sum</em>{i=k+1}^{n}\text{Pr}(S<em>i) = \sum</em>{i=k+1}^{n}\text{Pr}(A_i \cap B<em>i) \<br>&amp;=\sum</em>{i=k+1}^{n}\text{Pr}(A_i) \text{Pr}(B<em>i)\<br>&amp;=\sum</em>{i=k+1}^{n}\frac{k}{n(i-1)}\<br>&amp;=\frac{k}{n}\sum<em>{i=k}^{n-1}\frac{1}{i}\<br>\end{align}<br>$$<br>根据放缩公式，我们可以得到：<br>$$<br>\int</em>{k}^{n}\frac{1}{x}\mathbf{d}x \le \frac{k}{n}\sum<em>{i=k}^{n-1}\frac{1}{i} \le \int</em>{k-1}^{n-1}\frac{1}{x}\mathbf{d}x.<br>$$<br>从而，我们解这个定积分，可以得到：<br>$$<br>\frac{k}{n}(\mathbf{ln}n - \mathbf{ln}k) \le \text{Pr}(S) \le \frac{k}{n}(\mathbf{ln}(n-1) - \mathbf{ln}(k-1)).<br>$$<br>其中，等式左边为妹子在第$i$个男友时找到Mr. Right的概率的下界。由于我们希望最大化成功的概率，我们希望能够最大化这个下界。因此，我们将下界表达式$\frac{k}{n}(\mathbf{ln}n - \mathbf{ln}k)$对$k$求导，得：<br>$$<br>\frac{1}{n}(\mathbf{ln}n - \mathbf{ln}k -1)<br>$$<br>在对$k$导函数单调递减的情况下，令此导数等于0，我们可以得到:<br>$$<br>\begin{align}<br>&amp;\mathbf{ln}k = \mathbf{ln}n -1 = \mathbf{ln}\frac{n}{e}\<br>\Leftrightarrow \text{            } &amp;k=\frac{n}{e},<br>\end{align}<br>$$<br>即当$k=\frac{n}{e}$时，概率的下界最大化为$\frac{1}{e}$。换句话说，假如一共可以尝试去和$n$个男性交往，妹子们可以选择交往过$k=\frac{n}{e}$男友来积累经验，然后遇到更好的人就从了。因为这样，妹子们有最大的几率——超过$\frac{1}{e}$会找到人群中最优质的男性。</p>
<p>以之前所说的20个理论中交男友的机会为例，妹子们可以先通过之前的$\frac{20}{e} \approx 7$ 个男友来积攒经验，并在之后如果遇到比前七个男友都优秀的男性就从了，将会有高于$36.7\%$的几率找到属于自己的Mr. Right.</p>
<p>以上皆为扯淡之谈。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ohyoukillkenny.github.io/blog/04/02/boyfriend/" data-id="cjfuybs1r0014c7avxcnvo458" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Code/">Code</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Web3-Solidity" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/03/27/Web3-Solidity/" class="article-date">
  <time datetime="2018-03-27T13:17:16.000Z" itemprop="datePublished">2018-03-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/Learn-Solidity/">Learn Solidity</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/03/27/Web3-Solidity/">Web3-Solidity</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Solidity学习笔记-5-—-使用Web3-js实现与Smart-Contract的交互"><a href="#Solidity学习笔记-5-—-使用Web3-js实现与Smart-Contract的交互" class="headerlink" title="Solidity学习笔记(5) — 使用Web3.js实现与Smart Contract的交互"></a>Solidity学习笔记(5) — 使用Web3.js实现与Smart Contract的交互</h3><p><strong>作者</strong>：孔令坤，<strong>转载请注明出处</strong></p>
<p>Web3官方API：<a href="https://github.com/ethereum/wiki/wiki/JavaScript-API" target="_blank" rel="noopener">https://github.com/ethereum/wiki/wiki/JavaScript-API</a></p>
<p>Youtube环境搭配视频：<a href="https://coursetro.com/courses/20/Developing-Ethereum-Smart-Contracts-for-Beginners" target="_blank" rel="noopener">https://coursetro.com/courses/20/Developing-Ethereum-Smart-Contracts-for-Beginners</a></p>
<p>在本文中，我写了一个很简单的存取钱的智能合约，并借助web3.js提供的接口写了一个非常简单 的网页，来实现用户通过网页与smart contract的交互。</p>
<h4 id="1-环境配置"><a href="#1-环境配置" class="headerlink" title="1.环境配置"></a>1.环境配置</h4><p>首先，用户需要在google chrome中配置<a href="https://karl.tech/learning-solidity-part-1-deploy-a-contract/" target="_blank" rel="noopener">MetaMask</a>。</p>
<p>之后，用户需要安装web3.js，具体安装方式见<a href="https://github.com/ethereum/wiki/wiki/JavaScript-API" target="_blank" rel="noopener">官方安装文档</a>。</p>
<p>接下来，为了能在本地端实现web3.js与metamask中的账号以及smart contract的交互，我们需要在本地为网页文件创造一个虚拟的服务器环境。这里，我们使用lite-server来帮助我们实现这个需求。具体安装方法如下：</p>
<ol>
<li>在装好web.js的文件夹目录下输入command line code：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; npm install lite-server --save-dev</span><br></pre></td></tr></table></figure>
<p>如果用户之前是全局安装web.js的话，需要先输入<code>npm init</code>。</p>
<ol>
<li>打开目录中的 <strong>package.json</strong>文件，在其中的<code>scripts</code>中添加：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;    </span><br><span class="line">    &quot;dev&quot;: &quot;lite-server&quot;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<ol>
<li>在目录中已有index.html文件的前提下，输入如下语句即可正常运行网页中的js脚本：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; npm run dev</span><br></pre></td></tr></table></figure>
<p>可能这里我讲得有点粗糙，但是不用担心。有人已经在youtube上提供了非常详细的安装流程，见<a href="https://coursetro.com/posts/code/103/Solidity-Inheritance-and-Deploying-an-Ethereum-Smart-Contract" target="_blank" rel="noopener">Youtube环境搭配视频</a>。</p>
<h4 id="2-smart-contract开发"><a href="#2-smart-contract开发" class="headerlink" title="2.smart contract开发"></a>2.smart contract开发</h4><p>如果大家已经看过了我之前的博客，相信这一部分对于大家而言将不存在任何理解上的困难。</p>
<p>所以这里我简单的直接放上代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.21</span>;</span><br><span class="line"></span><br><span class="line">contract SaveMoney&#123;</span><br><span class="line">	address public user;</span><br><span class="line">	string public userName;</span><br><span class="line">	uint public deposits;</span><br><span class="line"></span><br><span class="line">	enum State &#123;Unoccupied, Occupied&#125;</span><br><span class="line">	State public state;</span><br><span class="line"></span><br><span class="line">	event accountInited(uint m, string name);</span><br><span class="line">	event moneyWithdrawed();</span><br><span class="line"></span><br><span class="line">	modifier condition(bool _condition) &#123;</span><br><span class="line">	    <span class="built_in">require</span>(_condition);</span><br><span class="line">	    _;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	modifier onlyUser() &#123;</span><br><span class="line">	    <span class="built_in">require</span>(msg.sender == user);</span><br><span class="line">	    _;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	modifier inState(State _state) &#123;</span><br><span class="line">	    <span class="built_in">require</span>(state == _state);</span><br><span class="line">	    _;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// initiate an account</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">initAccount</span>(<span class="params">uint _money, string _userName</span>)</span></span><br><span class="line"><span class="function">	    <span class="title">public</span></span></span><br><span class="line"><span class="function">	    <span class="title">inState</span>(<span class="params">State.Unoccupied</span>)</span></span><br><span class="line"><span class="function">	    <span class="title">condition</span>(<span class="params">msg.value &gt; _money</span>) // <span class="title">since</span> <span class="title">initiation</span> <span class="title">costs</span> <span class="title">some</span> <span class="title">gas</span></span></span><br><span class="line"><span class="function">	    <span class="title">payable</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">	    user = msg.sender;</span><br><span class="line">	    userName = _userName;</span><br><span class="line">	    deposits = _money;</span><br><span class="line">        state = State.Occupied;</span><br><span class="line">        user.transfer(<span class="keyword">this</span>.balance);</span><br><span class="line">        emit accountInited(_money, _userName);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// withdraw the money from the contract</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">withDraw</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">	    <span class="title">public</span></span></span><br><span class="line"><span class="function">        <span class="title">inState</span>(<span class="params">State.Occupied</span>)</span></span><br><span class="line"><span class="function">        <span class="title">onlyUser</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        deposits = <span class="number">0</span>;</span><br><span class="line">        user.transfer(<span class="keyword">this</span>.balance);</span><br><span class="line">        state = State.Unoccupied;</span><br><span class="line">        emit moneyWithdrawed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-网页开发与js脚本编写"><a href="#3-网页开发与js脚本编写" class="headerlink" title="3.网页开发与js脚本编写"></a>3.网页开发与js脚本编写</h4><p>首先，我放出网页的主体框架与css文件，其中大量借鉴了<a href="https://coursetro.com/courses/20/Developing-Ethereum-Smart-Contracts-for-Beginners" target="_blank" rel="noopener">Developing-Ethereum-Smart-Contracts-for-Beginners</a>中的框架。整体比较粗糙，但是非常便于大家理解代码。</p>
<p><strong>main.css</strong>文件：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>:<span class="number">#F0F0F0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">2em</span>;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">'Raleway'</span>,<span class="string">'Source Sans Pro'</span>, <span class="string">'Arial'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">label</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>:block;</span><br><span class="line">    <span class="attribute">margin-bottom</span>:<span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">input</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>:<span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">1em</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">button</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">2em</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">1em</span> <span class="number">4em</span>;</span><br><span class="line">    <span class="attribute">display</span>:block;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#instructor</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>:<span class="number">1em</span>;</span><br><span class="line">    <span class="attribute">background-color</span>:<span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">1em</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#loader</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">display</span>:none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>index.html</strong>框架</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"main.css"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./node_modules/web3/dist/web3.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Money Bank<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span> <span class="attr">id</span>=<span class="string">"User"</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"userTrans"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"loader"</span> <span class="attr">src</span>=<span class="string">"https://loading.io/spinners/double-ring/lg.double-ring-spinner.gif"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"userName"</span> <span class="attr">class</span>=<span class="string">"col-lg-2 control-label"</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"userName"</span> <span class="attr">type</span>=<span class="string">"text"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"money"</span> <span class="attr">class</span>=<span class="string">"col-lg-2 control-label"</span>&gt;</span># of Money<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"money"</span> <span class="attr">type</span>=<span class="string">"text"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"button1"</span>&gt;</span>Save Money<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"button2"</span>&gt;</span>Withdraw<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://code.jquery.com/jquery-3.2.1.slim.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">       <span class="comment">// Put Scripts Here...</span></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<img src="/blog/03/27/Web3-Solidity/web.png" title="网页截图">
<p>下面，我将分布挑重点来介绍一下我的js代码。</p>
<p>首先，我们在代码中放入：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> web3 !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    web3 = <span class="keyword">new</span> Web3(web3.currentProvider);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// set the provider you want from Web3.providers</span></span><br><span class="line">    web3 = <span class="keyword">new</span> Web3(<span class="keyword">new</span> Web3.providers.HttpProvider(<span class="string">"http://localhost:8545"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这一段是官方提供的初始化连接web3的代码。如果你使用了metamask，那么currentProvider就会是来自你的metamask的网络以及账号。这个时候，在remix上，你的smart contract创建方式应当选择Injected Web3。</p>
<p>若你没有使用metamask，那么你可以在remix上使用Web3 Provider的方式来创建smart contract。这里<code>&quot;http://localhost:8545&quot;</code>其实来自另一个好用的eth smart contract开发应用，其安装方式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; npm install -g ethereumjs-testrpc</span><br></pre></td></tr></table></figure>
<p>通过<code>&gt;&gt; testrpc</code>来启动这个provider并通过<code>&quot;http://localhost:8545&quot;</code>来进行数据的发送。</p>
<p>接下来，我们选择web3应用中的账户。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web3.eth.defaultAccount = web3.eth.accounts[<span class="number">0</span>];</span><br></pre></td></tr></table></figure>
<p>接下来，我们建立网页与合约之间的直接关联：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> saveMoney = web3.eth.contract(ABI OF THE CONTRACT);</span><br><span class="line"><span class="keyword">var</span> saveMoneyContract = saveMoney.at(<span class="string">'ADDR OF THE CONTRACT'</span>);</span><br></pre></td></tr></table></figure>
<p>ABI即smart contract编译后产生的一个文件，在remix中点击Start to compile按钮，然后点击Details按钮，即可复制smart contract的ABI，大致格式如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">"constant"</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="attr">"inputs"</span>: [],</span><br><span class="line">		<span class="attr">"name"</span>: <span class="string">"withDraw"</span>,</span><br><span class="line">		<span class="attr">"outputs"</span>: [],</span><br><span class="line">		<span class="attr">"payable"</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="attr">"stateMutability"</span>: <span class="string">"nonpayable"</span>,</span><br><span class="line">		<span class="attr">"type"</span>: <span class="string">"function"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">"constant"</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="attr">"inputs"</span>: [],</span><br><span class="line">		<span class="attr">"name"</span>: <span class="string">"deposits"</span>,</span><br><span class="line">		<span class="attr">"outputs"</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">"name"</span>: <span class="string">""</span>,</span><br><span class="line">				<span class="attr">"type"</span>: <span class="string">"uint256"</span></span><br><span class="line">			&#125;</span><br><span class="line">		],</span><br><span class="line">		<span class="attr">"payable"</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="attr">"stateMutability"</span>: <span class="string">"view"</span>,</span><br><span class="line">		<span class="attr">"type"</span>: <span class="string">"function"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	......</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">"anonymous"</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="attr">"inputs"</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">"indexed"</span>: <span class="literal">false</span>,</span><br><span class="line">				<span class="attr">"name"</span>: <span class="string">"m"</span>,</span><br><span class="line">				<span class="attr">"type"</span>: <span class="string">"uint256"</span></span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">"indexed"</span>: <span class="literal">false</span>,</span><br><span class="line">				<span class="attr">"name"</span>: <span class="string">"name"</span>,</span><br><span class="line">				<span class="attr">"type"</span>: <span class="string">"string"</span></span><br><span class="line">			&#125;</span><br><span class="line">		],</span><br><span class="line">		<span class="attr">"name"</span>: <span class="string">"accountInited"</span>,</span><br><span class="line">		<span class="attr">"type"</span>: <span class="string">"event"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">"anonymous"</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="attr">"inputs"</span>: [],</span><br><span class="line">		<span class="attr">"name"</span>: <span class="string">"moneyWithdrawed"</span>,</span><br><span class="line">		<span class="attr">"type"</span>: <span class="string">"event"</span></span><br><span class="line">	&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>然后smart contract的address的获取就比较简单了，就是创建好smart contract后，copy地址即可，e.g. <code>0x8f7e0a306b1a1f1205fa47b2bf2fefabaf056dae</code>。</p>
<p>之后，设置点击save money和 withdraw按钮的触发事件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">"#button1"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">"#loader"</span>).show();</span><br><span class="line">    saveMoneyContract.initAccount($(<span class="string">"#money"</span>).val(), $(<span class="string">"#userName"</span>).val(), &#123;<span class="attr">value</span>: $(<span class="string">"#money"</span>).val()+<span class="number">100000</span>&#125; ,(err, res) =&gt; &#123;</span><br><span class="line">       <span class="keyword">if</span> (err) &#123;</span><br><span class="line">           $(<span class="string">"#loader"</span>).hide();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$(<span class="string">"#button2"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">"#loader"</span>).show();</span><br><span class="line">    saveMoneyContract.withDraw(<span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (err) &#123;</span><br><span class="line">           $(<span class="string">"#loader"</span>).hide();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>其中需要注意的是initAccount函数中参数的设定。由于这个函数是一个带value的payable的函数，我们需要在编程时不仅传递函数的参数，还得传递一定数量的以太币。在查阅了官方的api文件后，可以用如上的方式传递value，即</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function(param1, param2, ..., paramk, &#123;value: # of eth&#125;)</span><br></pre></td></tr></table></figure>
<p>这里我在设置value时使用了<code>$(&quot;#money&quot;).val()+100000</code>，这是因为提交函数需要消耗一定量的gas，+100000wei是为了防止由于gas的消耗，用户无法在账户中存入数量为<code>$(&quot;#money&quot;).val()</code>的金额，导致交易失败。</p>
<p>最后，我们通过监听smart contract中的event来在网页上输出数据，代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> saveEvent = saveMoneyContract.accountInited(&#123;&#125;, <span class="string">'latest'</span>);</span><br><span class="line"></span><br><span class="line">saveEvent.watch(<span class="function"><span class="keyword">function</span>(<span class="params">error, result</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!error)&#123;</span><br><span class="line">        $(<span class="string">"#loader"</span>).hide();</span><br><span class="line">        $(<span class="string">"#userTrans"</span>).html(<span class="string">'Block hash: '</span> + result.blockHash);</span><br><span class="line">        <span class="built_in">console</span>.log(result);</span><br><span class="line">        $(<span class="string">"#User"</span>).html(result.args.name +<span class="string">' saved '</span> + result.args.m.c + <span class="string">' wei.'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $(<span class="string">"#loader"</span>).hide();</span><br><span class="line">        <span class="built_in">console</span>.log(error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> withDrawEvent = saveMoneyContract.moneyWithdrawed(&#123;&#125;, <span class="string">'latest'</span>);</span><br><span class="line"></span><br><span class="line">withDrawEvent.watch(<span class="function"><span class="keyword">function</span>(<span class="params">err, res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!err)&#123;</span><br><span class="line">        $(<span class="string">"#loader"</span>).hide();</span><br><span class="line">        $(<span class="string">"#userTrans"</span>).html(<span class="string">'Block hash: '</span> + res.blockHash);</span><br><span class="line">        $(<span class="string">"#User"</span>).html(<span class="string">'Money has been withdrawed!'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $(<span class="string">"#loader"</span>).hide();</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>最后，我附上了<strong>index.html</strong>文件的完整代码，供大家参考：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"main.css"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./node_modules/web3/dist/web3.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Money Bank<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span> <span class="attr">id</span>=<span class="string">"User"</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"userTrans"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"loader"</span> <span class="attr">src</span>=<span class="string">"https://loading.io/spinners/double-ring/lg.double-ring-spinner.gif"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"userName"</span> <span class="attr">class</span>=<span class="string">"col-lg-2 control-label"</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"userName"</span> <span class="attr">type</span>=<span class="string">"text"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"money"</span> <span class="attr">class</span>=<span class="string">"col-lg-2 control-label"</span>&gt;</span># of Money<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"money"</span> <span class="attr">type</span>=<span class="string">"text"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"button1"</span>&gt;</span>Save Money<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"button2"</span>&gt;</span>Withdraw<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://code.jquery.com/jquery-3.2.1.slim.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">       <span class="keyword">if</span> (<span class="keyword">typeof</span> web3 !== <span class="string">'undefined'</span>) &#123;</span></span><br><span class="line"><span class="javascript">            web3 = <span class="keyword">new</span> Web3(web3.currentProvider);</span></span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// set the provider you want from Web3.providers</span></span></span><br><span class="line"><span class="javascript">            web3 = <span class="keyword">new</span> Web3(<span class="keyword">new</span> Web3.providers.HttpProvider(<span class="string">"http://localhost:8545"</span>));</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        web3.eth.defaultAccount = web3.eth.accounts[0];</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> saveMoney = web3.eth.contract([</span></span><br><span class="line"><span class="undefined">            &#123;</span></span><br><span class="line"><span class="javascript">                <span class="string">"constant"</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"inputs"</span>: [],</span></span><br><span class="line"><span class="javascript">                <span class="string">"name"</span>: <span class="string">"withDraw"</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"outputs"</span>: [],</span></span><br><span class="line"><span class="javascript">                <span class="string">"payable"</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"stateMutability"</span>: <span class="string">"nonpayable"</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"type"</span>: <span class="string">"function"</span></span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="undefined">            &#123;</span></span><br><span class="line"><span class="javascript">                <span class="string">"constant"</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"inputs"</span>: [],</span></span><br><span class="line"><span class="javascript">                <span class="string">"name"</span>: <span class="string">"deposits"</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"outputs"</span>: [</span></span><br><span class="line"><span class="undefined">                    &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="string">"name"</span>: <span class="string">""</span>,</span></span><br><span class="line"><span class="javascript">                        <span class="string">"type"</span>: <span class="string">"uint256"</span></span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                ],</span></span><br><span class="line"><span class="javascript">                <span class="string">"payable"</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"stateMutability"</span>: <span class="string">"view"</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"type"</span>: <span class="string">"function"</span></span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="undefined">            &#123;</span></span><br><span class="line"><span class="javascript">                <span class="string">"constant"</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"inputs"</span>: [],</span></span><br><span class="line"><span class="javascript">                <span class="string">"name"</span>: <span class="string">"user"</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"outputs"</span>: [</span></span><br><span class="line"><span class="undefined">                    &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="string">"name"</span>: <span class="string">""</span>,</span></span><br><span class="line"><span class="javascript">                        <span class="string">"type"</span>: <span class="string">"address"</span></span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                ],</span></span><br><span class="line"><span class="javascript">                <span class="string">"payable"</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"stateMutability"</span>: <span class="string">"view"</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"type"</span>: <span class="string">"function"</span></span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="undefined">            &#123;</span></span><br><span class="line"><span class="javascript">                <span class="string">"constant"</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"inputs"</span>: [],</span></span><br><span class="line"><span class="javascript">                <span class="string">"name"</span>: <span class="string">"userName"</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"outputs"</span>: [</span></span><br><span class="line"><span class="undefined">                    &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="string">"name"</span>: <span class="string">""</span>,</span></span><br><span class="line"><span class="javascript">                        <span class="string">"type"</span>: <span class="string">"string"</span></span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                ],</span></span><br><span class="line"><span class="javascript">                <span class="string">"payable"</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"stateMutability"</span>: <span class="string">"view"</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"type"</span>: <span class="string">"function"</span></span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="undefined">            &#123;</span></span><br><span class="line"><span class="javascript">                <span class="string">"constant"</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"inputs"</span>: [],</span></span><br><span class="line"><span class="javascript">                <span class="string">"name"</span>: <span class="string">"state"</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"outputs"</span>: [</span></span><br><span class="line"><span class="undefined">                    &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="string">"name"</span>: <span class="string">""</span>,</span></span><br><span class="line"><span class="javascript">                        <span class="string">"type"</span>: <span class="string">"uint8"</span></span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                ],</span></span><br><span class="line"><span class="javascript">                <span class="string">"payable"</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"stateMutability"</span>: <span class="string">"view"</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"type"</span>: <span class="string">"function"</span></span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="undefined">            &#123;</span></span><br><span class="line"><span class="javascript">                <span class="string">"constant"</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"inputs"</span>: [</span></span><br><span class="line"><span class="undefined">                    &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="string">"name"</span>: <span class="string">"_money"</span>,</span></span><br><span class="line"><span class="javascript">                        <span class="string">"type"</span>: <span class="string">"uint256"</span></span></span><br><span class="line"><span class="undefined">                    &#125;,</span></span><br><span class="line"><span class="undefined">                    &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="string">"name"</span>: <span class="string">"_userName"</span>,</span></span><br><span class="line"><span class="javascript">                        <span class="string">"type"</span>: <span class="string">"string"</span></span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                ],</span></span><br><span class="line"><span class="javascript">                <span class="string">"name"</span>: <span class="string">"initAccount"</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"outputs"</span>: [],</span></span><br><span class="line"><span class="javascript">                <span class="string">"payable"</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"stateMutability"</span>: <span class="string">"payable"</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"type"</span>: <span class="string">"function"</span></span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="undefined">            &#123;</span></span><br><span class="line"><span class="javascript">                <span class="string">"anonymous"</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"inputs"</span>: [</span></span><br><span class="line"><span class="undefined">                    &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="string">"indexed"</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">                        <span class="string">"name"</span>: <span class="string">"m"</span>,</span></span><br><span class="line"><span class="javascript">                        <span class="string">"type"</span>: <span class="string">"uint256"</span></span></span><br><span class="line"><span class="undefined">                    &#125;,</span></span><br><span class="line"><span class="undefined">                    &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="string">"indexed"</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">                        <span class="string">"name"</span>: <span class="string">"name"</span>,</span></span><br><span class="line"><span class="javascript">                        <span class="string">"type"</span>: <span class="string">"string"</span></span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                ],</span></span><br><span class="line"><span class="javascript">                <span class="string">"name"</span>: <span class="string">"accountInited"</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"type"</span>: <span class="string">"event"</span></span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="undefined">            &#123;</span></span><br><span class="line"><span class="javascript">                <span class="string">"anonymous"</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"inputs"</span>: [],</span></span><br><span class="line"><span class="javascript">                <span class="string">"name"</span>: <span class="string">"moneyWithdrawed"</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"type"</span>: <span class="string">"event"</span></span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        ]);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> saveMoneyContract = saveMoney.at(<span class="string">'0x8f7e0a306b1a1f1205fa47b2bf2fefabaf056dae'</span>);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(saveMoneyContract);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> saveEvent = saveMoneyContract.accountInited(&#123;&#125;, <span class="string">'latest'</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        saveEvent.watch(<span class="function"><span class="keyword">function</span>(<span class="params">error, result</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (!error)&#123;</span></span><br><span class="line"><span class="javascript">                $(<span class="string">"#loader"</span>).hide();</span></span><br><span class="line"><span class="javascript">                $(<span class="string">"#userTrans"</span>).html(<span class="string">'Block hash: '</span> + result.blockHash);</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(result);</span></span><br><span class="line"><span class="javascript">                $(<span class="string">"#User"</span>).html(result.args.name +<span class="string">' saved '</span> + result.args.m.c + <span class="string">' wei.'</span>);</span></span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                $(<span class="string">"#loader"</span>).hide();</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(error);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> withDrawEvent = saveMoneyContract.moneyWithdrawed(&#123;&#125;, <span class="string">'latest'</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        withDrawEvent.watch(<span class="function"><span class="keyword">function</span>(<span class="params">err, res</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (!err)&#123;</span></span><br><span class="line"><span class="javascript">                $(<span class="string">"#loader"</span>).hide();</span></span><br><span class="line"><span class="javascript">                $(<span class="string">"#userTrans"</span>).html(<span class="string">'Block hash: '</span> + res.blockHash);</span></span><br><span class="line"><span class="javascript">                $(<span class="string">"#User"</span>).html(<span class="string">'Money has been withdrawed!'</span>);</span></span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                $(<span class="string">"#loader"</span>).hide();</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(err);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#button1"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">"#loader"</span>).show();</span></span><br><span class="line"><span class="javascript">            saveMoneyContract.initAccount($(<span class="string">"#money"</span>).val(), $(<span class="string">"#userName"</span>).val(), &#123;<span class="attr">value</span>: $(<span class="string">"#money"</span>).val()+<span class="number">100000</span>&#125; ,(err, res) =&gt; &#123;</span></span><br><span class="line"><span class="javascript">               <span class="keyword">if</span> (err) &#123;</span></span><br><span class="line"><span class="javascript">                   $(<span class="string">"#loader"</span>).hide();</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#button2"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">"#loader"</span>).show();</span></span><br><span class="line"><span class="javascript">            saveMoneyContract.withDraw(<span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">               <span class="keyword">if</span> (err) &#123;</span></span><br><span class="line"><span class="javascript">                   $(<span class="string">"#loader"</span>).hide();</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ohyoukillkenny.github.io/blog/03/27/Web3-Solidity/" data-id="cjfuybs00000cc7avnqy4fw9m" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/code/">code</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><a class="page-number" href="/blog/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/5/">5</a><a class="extend next" rel="next" href="/blog/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Algorithms/">Algorithms</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Learn-Solidity/">Learn Solidity</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/articles/">articles</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Code/">Code</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/code/">code</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/code-tools/">code tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/projects-code/">projects, code</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/blog/tags/Code/" style="font-size: 10px;">Code</a> <a href="/blog/tags/code/" style="font-size: 20px;">code</a> <a href="/blog/tags/code-tools/" style="font-size: 10px;">code tools</a> <a href="/blog/tags/projects-code/" style="font-size: 10px;">projects, code</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/01/">January 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/04/11/LearnSolidity5/">Project — Building a Simple Blockchain-based Crowdsensing System</a>
          </li>
        
          <li>
            <a href="/blog/04/02/boyfriend/">How to find the Mr. Right</a>
          </li>
        
          <li>
            <a href="/blog/03/27/Web3-Solidity/">Web3-Solidity</a>
          </li>
        
          <li>
            <a href="/blog/03/24/LearnSolidity4/">LearnSolidity4 — CrowdSensing</a>
          </li>
        
          <li>
            <a href="/blog/02/06/hanoi/">Hanoi in Assembly x86 (NASM)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Lingkun Kong<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">
  <script src="/blog/fancybox/jquery.fancybox.pack.js"></script>


<script src="/blog/js/script.js"></script>



  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>